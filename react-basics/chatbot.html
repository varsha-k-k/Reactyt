<!DOCTYPE html>
<html>
  <head>
    <title>React Basics</title>

    <style>
      body {
        font-family: 'Courier New', Courier, monospace;
        margin-top: 0px;
        margin-bottom: 0px;
      }
      input {
        font-family: 'Courier New', Courier, monospace;
      }

      .btn {
        background-color: greenyellow;
        color: white;
        padding: 10px 10px;
        margin-left: 10px;
        border:none;
        border-radius: 10px;
        font-size: 15px;
        cursor: pointer;
        font-family: 'Courier New', Courier, monospace;
      }

      .input-field {
        padding:10px 10px;
        border-radius: 10px;
        border-width: 1px;
        font-size: 15px;  
        flex-grow: 1;
      }

      .chat-input {
        display: flex;
        margin-bottom: 30px;
      
      }

      .app-container {
        max-width: 600px;
        margin-left:auto;
        margin-right:auto;
        height:100vh;
        display: flex;
        flex-direction: column;
      }

      .user-msg {
        display:flex;
        justify-content:flex-end;
        align-items: start;
      } 

      .bot-msg {
        display: flex;
        align-items: start;
      }

      .chat-message-text {
        background-color:lightcyan;
        padding: 10px 10px;
        margin: 10px;
        border-radius: 10px;
        max-width:300px;
      }
     .bot-img {
      width: 45px;
     }
     .user-img {
      width:45px;
     }

     .chat-messages-container {
      flex-grow: 1;
      margin-top:10px;
      overflow: scroll;
      scrollbar-width: none;
     }
    </style>
  </head>
  <body>
    <div class="js-container"></div>

    <!-- <script src="https://unpkg.com/supersimpledev/react.js"></script>
    <script src="https://unpkg.com/supersimpledev/react-dom.js"></script> -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>


    <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    <!-- <script src="https://unpkg.com/supersimpledev/babel.js"></script> -->
    <script type="text/babel">


      
      function handleKey(event,sendMessage)
      {
          if(event.key==="Enter")
          {
              sendMessage();
          }
      }

      function ChatInput({chatMessage,setChatMessage})
      {
        const [isLoading,setIsLoading]=React.useState(false);

         const [inputText,setInputText]=React.useState('');

                  function updateChange(event)
                  {
                      setInputText(event.target.value);
            
                  }

                    async function sendMessage()
                  {
                              if (!inputText.trim() || isLoading) return; // prevent empty/duplicate sends

                              setIsLoading(true);
                              const newChatMessage=[...chatMessage,{message:inputText,sender:'user',key:crypto.randomUUID()}];
                              setChatMessage(newChatMessage);

                              try
                              {

                                  const response= await Chatbot.getResponseAsync(inputText);

                                    setChatMessage([...newChatMessage,{message:response,sender:'bot',key:crypto.randomUUID()}]);
                              }
                          finally
                          {
                            
                            setIsLoading(false);
                            setInputText("");
                          }

                  }

      
          return (
            <div className="chat-input">
              <input
                 onKeyDown={(event)=>{
                if(event.key==="Enter")
                {
                    sendMessage();
                } 

                else if(event.key==="Escape")
                {
                    setInputText("");
                }

              }} 
                onChange={updateChange} 
                value={isLoading ? 'Loading...' : inputText} 
                disabled={isLoading} 
                className="input-field"
                placeholder="Send a Message to Chatbot"
                    />


              <button onClick={sendMessage}
              className="btn" disabled={isLoading}>
             {isLoading ? 'loading...' : 'Send'}</button>
          </div>
          );
}

function ChatMessage(props)
{
      const {message,sender}=props;
      
      return (
        <div className={
          sender==='user' 
          ? 'user-msg'
           :'bot-msg'
        }>
        {sender==='bot' && <img src="robot.png" className="bot-img"/>}

      <div className="chat-message-text"> 
          {message} 
      </div>
      {sender==='user' &&<img src="user.png" className="user-img" />}
        </div>
      );
}

function ChatMessages({chatMessage})
{

    const chatMessageRef= React.useRef(null);
    React.useEffect(()=>
   {
       if(chatMessageRef.current)
       {
            chatMessageRef.current.scrollTop=chatMessageRef.current.scrollHeight;
         }
  },[chatMessage])

    return(
      <div className="chat-messages-container"
           ref={chatMessageRef}>
       { chatMessage.map((chatMessage)=>
      {
          return (<ChatMessage message={chatMessage.message} sender={chatMessage.sender}
                     key={chatMessage.key} />
                );
      }           
      )}</div>)
}

function App()
{
   const [chatMessage, setChatMessage] = React.useState([{message:'hello chatbot',sender:'user',key:1},
                 {message:'Hello! How can I help you?',sender:'bot',key:2}
                  ]);
  return (
    <div className="app-container">
      
       <ChatMessages chatMessage={chatMessage} 
       setChatMessage={setChatMessage}/>

      <ChatInput chatMessage={chatMessage} 
       setChatMessage={setChatMessage}
       />

  </div> 
  );
}

      const container = document.querySelector('.js-container');
      ReactDOM.createRoot(container).render(<App />);

    </script>
  </body>
</html>